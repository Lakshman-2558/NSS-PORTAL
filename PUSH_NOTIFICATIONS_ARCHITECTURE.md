# Push Notifications System Architecture

## System Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STUDENT MOBILE/WEB                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  React App       â”‚         â”‚  Service Worker          â”‚         â”‚
â”‚  â”‚                  â”‚         â”‚  (firebase-messaging-sw) â”‚         â”‚
â”‚  â”‚  - UI Components â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  - Background messages   â”‚         â”‚
â”‚  â”‚  - Auth Logic    â”‚         â”‚  - Offline support       â”‚         â”‚
â”‚  â”‚  - Firebase Init â”‚         â”‚  - Notification click    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    handling              â”‚         â”‚
â”‚           â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                              â–²                         â”‚
â”‚           â”‚                              â”‚                         â”‚
â”‚           â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚           â”‚                      â”‚                â”‚                â”‚
â”‚    Browser/App Request    Push Notifications   In-App Messages    â”‚
â”‚           â”‚                (FCM)                                   â”‚
â”‚           â–¼                      â”‚                â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                â–¼                â”‚
â”‚  â”‚ Device Storage   â”‚           â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ - Device Token   â”‚           â”‚      â”‚  System Notif    â”‚       â”‚
â”‚  â”‚ - User Prefs     â”‚           â”‚      â”‚  (Lock Screen)   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â”‚                      â”‚                â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                      â”‚                â”‚
            â”‚                      â”‚                â”‚
            â–¼                      â–¼                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚        FIREBASE CLOUD MESSAGING (FCM)           â”‚â”‚
â”‚                                                 â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  - Receives notifications from server    â”‚  â”‚â”‚
â”‚  â”‚  - Routes to correct device              â”‚  â”‚â”‚
â”‚  â”‚  - Handles delivery & receipts           â”‚  â”‚â”‚
â”‚  â”‚  - Manages topics & subscriptions        â”‚  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            â–²                                        â”‚
            â”‚                                        â”‚
            â”‚                                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  (System Notification)
                  (Appears on Lock Screen)
                        â”‚
                        â–¼
                   ANDROID/iOS/Web OS
            (Browser/Phone OS displays notification)
```

## Server-Side Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NSS PORTAL BACKEND                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Express Server                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Routes                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - /api/events                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - /api/participations                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - /api/certificates                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - /api/push-notifications   â—„â”€â”€â”€ NEW               â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                    â”‚                                â”‚
â”‚           â–¼                    â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Event Create   â”‚  â”‚ Push Notification       â”‚            â”‚
â”‚  â”‚  Flow           â”‚  â”‚ Helper Utility          â”‚            â”‚
â”‚  â”‚                 â”‚  â”‚                          â”‚            â”‚
â”‚  â”‚ 1. Create Event â”‚  â”‚ - notifyUser()          â”‚            â”‚
â”‚  â”‚ 2. Store in DB  â”‚  â”‚ - notifyUsers()         â”‚            â”‚
â”‚  â”‚ 3. Call notify  â”‚  â”‚ - notifyAllStudents()   â”‚            â”‚
â”‚  â”‚ 4. Return 201   â”‚  â”‚ - broadcastNotificationâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚           â”‚                        â”‚                          â”‚
â”‚           â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚           â”‚          â”‚                           â”‚            â”‚
â”‚           â”‚          â–¼                           â–¼            â”‚
â”‚           â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚           â”‚     â”‚  Check User Preferences               â”‚   â”‚
â”‚           â”‚     â”‚  - Event notifications?               â”‚   â”‚
â”‚           â”‚     â”‚  - Participation updates?             â”‚   â”‚
â”‚           â”‚     â”‚  - Certificate notifications?         â”‚   â”‚
â”‚           â”‚     â”‚  - System notifications?              â”‚   â”‚
â”‚           â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                        â”‚                         â”‚
â”‚           â”‚                        â–¼                         â”‚
â”‚           â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚           â”‚     â”‚  Firebase Service                      â”‚   â”‚
â”‚           â”‚     â”‚  - sendNotificationToDevice()         â”‚   â”‚
â”‚           â”‚     â”‚  - sendMulticastNotification()        â”‚   â”‚
â”‚           â”‚     â”‚  - subscribeToTopic()                â”‚   â”‚
â”‚           â”‚     â”‚  - unsubscribeFromTopic()            â”‚   â”‚
â”‚           â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                  â”‚                             â”‚
â”‚           â”‚                  â–¼                             â”‚
â”‚           â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ MongoDB - Notificationâ”‚               â”‚
â”‚                    â”‚ In-App Notification  â”‚               â”‚
â”‚                    â”‚ Real-time logging    â”‚               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚         â”‚   Firebase Admin SDK                   â”‚        â”‚
â”‚         â”‚   (Initialized on server startup)     â”‚        â”‚
â”‚         â”‚   - Validates credentials             â”‚        â”‚
â”‚         â”‚   - Creates messaging instance        â”‚        â”‚
â”‚         â”‚   - Manages subscriptions             â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                â”‚
â”‚                          â–¼                                â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                  â”‚  FIREBASE (Google)â”‚                   â”‚
â”‚                  â”‚  Cloud Messaging  â”‚                   â”‚
â”‚                  â”‚  Services         â”‚                   â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow for New Event Notification

```
STEP 1: Admin Creates Event
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin App       â”‚
â”‚ - Fills form    â”‚
â”‚ - Clicks Submit â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/events           â”‚
â”‚ Backend Route              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Create event in DB
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB                    â”‚
â”‚ - Event stored             â”‚
â”‚ - EventID: 12345           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Call notifyAllStudents()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notification Helper                    â”‚
â”‚ - Get all students                     â”‚
â”‚ - Check preferences: eventNotify=true? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Get device tokens
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB - User Collection              â”‚
â”‚ - Student 1: [token_abc123]            â”‚
â”‚ - Student 2: [token_def456, token_xyz] â”‚
â”‚ - Student 3: [token_ghi789]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Send to Firebase
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase Service                       â”‚
â”‚ - sendMulticastNotification()           â”‚
â”‚ - Title: "ğŸ“… New Event: Beach Cleanup" â”‚
â”‚ - Body: "Event scheduled for Jan 20"   â”‚
â”‚ - Data: { eventId: 12345, ... }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Send messages
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase Cloud Messaging                    â”‚
â”‚ (Google's Infrastructure)                   â”‚
â”‚ - Routes to each device                     â”‚
â”‚ - Encrypts in transit                       â”‚
â”‚ - Retries if device offline                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
         â–¼                 â–¼                 â–¼
    Student 1          Student 2 (2 devices)   Student 3
    Android            iOS       Web Browser    Android
         â”‚                 â”‚          â”‚           â”‚
         â–¼                 â–¼          â–¼           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              DEVICES - 4 Total                       â”‚
  â”‚                                                      â”‚
  â”‚  ğŸ“± Android 1       ğŸ iOS          ğŸ’» Web         ğŸ“± Android 2
  â”‚  "New Event:        "New Event:     "New Event:    "New Event:
  â”‚   Beach Cleanup"    Beach Cleanup"  Beach Cleanup" Beach Cleanup"
  â”‚                                                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FRONTEND COMPONENTS                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  App.js (Root)                                            â”‚
â”‚  â””â”€ NotificationPreferences.js                            â”‚
â”‚     â””â”€ usePushNotifications.js (Hook)                    â”‚
â”‚        â”œâ”€ firebaseService.js                             â”‚
â”‚        â”‚  â”œâ”€ requestNotificationPermission()             â”‚
â”‚        â”‚  â”œâ”€ setupForegroundMessageHandler()             â”‚
â”‚        â”‚  â”œâ”€ registerDeviceToken()                       â”‚
â”‚        â”‚  â””â”€ getNotificationPreferences()                â”‚
â”‚        â”‚                                                  â”‚
â”‚        â””â”€ State Management                               â”‚
â”‚           â”œâ”€ notificationSupported                       â”‚
â”‚           â”œâ”€ notificationPermission                      â”‚
â”‚           â”œâ”€ deviceToken                                 â”‚
â”‚           â”œâ”€ isRegistered                                â”‚
â”‚           â”œâ”€ preferences                                 â”‚
â”‚           â””â”€ loading/error states                        â”‚
â”‚                                                            â”‚
â”‚  Service Worker (Browser)                                â”‚
â”‚  â””â”€ firebase-messaging-sw.js                            â”‚
â”‚     â”œâ”€ onBackgroundMessage()                            â”‚
â”‚     â”œâ”€ notificationclick handler                        â”‚
â”‚     â””â”€ Deep linking logic                               â”‚
â”‚                                                            â”‚
â”‚  Browser APIs Used:                                      â”‚
â”‚  â”œâ”€ Notification API                                    â”‚
â”‚  â”œâ”€ Service Worker API                                  â”‚
â”‚  â”œâ”€ LocalStorage (token persistence)                   â”‚
â”‚  â””â”€ IndexedDB (optional, for caching)                  â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema Changes

```
User Collection
â”œâ”€ _id
â”œâ”€ name
â”œâ”€ email
â”œâ”€ role
â”œâ”€ ...existing fields...
â”œâ”€ deviceTokens: [
â”‚  â”œâ”€ token (unique)
â”‚  â”œâ”€ deviceType (web, android, ios)
â”‚  â”œâ”€ deviceName
â”‚  â”œâ”€ isActive
â”‚  â”œâ”€ registeredAt
â”‚  â””â”€ lastUsedAt
â”‚ ]
â””â”€ notificationPreferences: {
   â”œâ”€ eventNotifications: boolean
   â”œâ”€ participationUpdates: boolean
   â”œâ”€ certificateNotifications: boolean
   â””â”€ systemNotifications: boolean
  }

Notification Collection (Existing)
â”œâ”€ _id
â”œâ”€ user (ref to User)
â”œâ”€ type (new-event, participation-approved, etc.)
â”œâ”€ message
â”œâ”€ data (mixed - stores notification metadata)
â”œâ”€ read
â”œâ”€ readAt
â””â”€ timestamps
```

## API Call Flow

```
Frontend                    Backend                 Firebase
   â”‚                           â”‚                        â”‚
   â”‚â”€â”€â”€ POST /push-notif/      â”‚                        â”‚
   â”‚    register-device        â”‚                        â”‚
   â”‚    { token, type }        â”‚                        â”‚
   â”‚                           â”œâ”€ Save to DB            â”‚
   â”‚                           â”œâ”€ Subscribe to topic    â”‚
   â”‚                           â”‚   (Firebase API call)  â”‚
   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                           â”‚                       â”‚ Subscribed
   â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚â—„â”€â”€â”€â”€â”€ 200 OK             â”‚                        â”‚
   â”‚      registered          â”‚                        â”‚
   â”‚                           â”‚                        â”‚
   â”‚â”€â”€â”€ GET /push-notif/      â”‚                        â”‚
   â”‚    preferences            â”‚                        â”‚
   â”‚                           â”œâ”€ Fetch from DB        â”‚
   â”‚â—„â”€â”€â”€â”€â”€ 200 OK             â”‚                        â”‚
   â”‚      preferences          â”‚                        â”‚
   â”‚                           â”‚                        â”‚
   â”‚                           â”‚
   â”‚ (Later: Admin creates event)
   â”‚                           â”‚
   â”‚                           â”œâ”€ Call notifyUser()   â”‚
   â”‚                           â”œâ”€ Check preferences   â”‚
   â”‚                           â”œâ”€ Get device tokens   â”‚
   â”‚                           â”œâ”€ Send notification   â”‚
   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                           â”‚                      â”‚ Send to devices
   â”‚                           â”‚                      â”‚ at:
   â”‚                           â”‚                      â”‚ - 192.168.1.5
   â”‚                           â”‚                      â”‚ - 203.0.113.42
   â”‚                           â”‚                      â”‚ - etc...
   â”‚â—„â”€ System Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚   (Appears on lock screen)                        â”‚
   â”‚                           â”‚                        â”‚
   â”‚â”€â”€â”€ Tap Notification â”€â”€â”€â”€â”€â”€â–º                       â”‚
   â”‚   Opens app to correct page
```

---

This architecture ensures:

- âœ… **Reliability** - Firebase handles delivery
- âœ… **Scalability** - Can send to millions of users
- âœ… **Privacy** - Respects user preferences
- âœ… **Real-time** - Instant notifications
- âœ… **Offline Support** - Works when app is closed
- âœ… **Deep Linking** - Opens correct page
